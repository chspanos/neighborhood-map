var ViewModel=function(){var a=this;this.menuVisible=ko.observable(!1),this.toggleMenu=function(){this.menuVisible(!this.menuVisible())},this.availableFilters=ko.observableArray([]),model.options.forEach(function(b){a.availableFilters.push(b)}),this.selectedFilter=ko.observable(this.availableFilters()[0]),this.placeList=ko.observableArray([]),model.places.forEach(function(b){a.placeList.push(new Place(b))}),this.filteredList=ko.computed(function(){return ko.utils.arrayFilter(this.placeList(),function(b){var c=a.selectedFilter();return"all"===c?(b.isDisplayed(!0),!0):b.types().indexOf(c)>=0?(b.isDisplayed(!0),!0):(b.isDisplayed(!1),!1)})},this),this.selectedPlace=ko.observable(null),this.windowVisible=ko.observable(!0),this.toggleWindow=function(){a.windowVisible(!a.windowVisible())},this.init=function(){model.map=mapView.displayMap(model.mapData.location),model.bounds=mapView.initBounds(),model.placeInfoWindow=mapView.initInfoWindow(),this.loadData(),this.createMarkers(),this.selectPlace(this.placeList()[0])},this.loadData=function(){for(var a=0;a<this.placeList().length;a++)fourSqView.loadFSData(this.placeList()[a].foursquareId(),a),wikiView.loadWikiData(this.placeList()[a].name(),a)},this.updateFSData=function(b,c,d,e){var f=a.placeList()[b];"Success"===e?(f.fourSqLink(c),f.fourSqTitle(f.name()),f.fourSqCategories(d),f.fourSqMsg("")):(f.fourSqLink(""),f.fourSqTitle(""),f.fourSqMsg(e))},this.updateWikiData=function(b,c,d,e){var f=a.placeList()[b];f.wikiLink(c),f.wikiTitle(d),f.wikiMsg(e)},this.createMarkers=function(){for(var a=0;a<this.placeList().length;a++){var b,c=this.placeList()[a].name(),d=this.placeList()[a].location(),e=this.placeList()[a].placeId();b=mapView.createMapMarker(model.map,model.bounds,d,c,a),mapView.loadPlaceDetails(model.map,b,e),model.markers.push(b)}},this.updatePhoto=function(b,c){a.placeList()[b].placesImg(c)},this.selectPlace=function(b){b!==a.selectedPlace()&&(a.toggleSelect(b),a.selectedPlace(b));var c=a.placeList.indexOf(b);a.activateMarker(model.markers[c]),a.windowVisible(!0)},this.updateSelectedPlace=function(b){var c=a.placeList()[b];a.selectPlace(c)},this.toggleSelect=function(b){null!==a.selectedPlace()&&a.selectedPlace().isSelected(!1),b.isSelected(!0)},this.activateMarker=function(a){null!==model.selectedMarker&&mapView.unhighlightMarker(model.selectedMarker),model.selectedMarker=a,mapView.highlightMarker(a),mapView.createInfoWindow(a,model.placeInfoWindow)},this.selectedFilter.subscribe(function(b){for(var c=0;c<a.placeList().length;c++)mapView.updateMarker(model.markers[c],a.placeList()[c].isDisplayed());a.selectPlace(a.filteredList()[0])},this,"change")},viewModel=new ViewModel;ko.applyBindings(viewModel);